"use strict";document.addEventListener("DOMContentLoaded",function(){pull("btn_one","menu_one"),pull("btn_two","menu_two"),pull("btn","box"),option("subnav");var n=document.querySelector("#csort");function c(t){var e=t.parent().next().text(),n=(e=(e=$.trim(e)).substring(1))*t.parent().find("input").val();t.parent().next().next().html("￥&nbsp;"+n.toFixed(2))}function a(){0==$(".jia").size()&&($(".cart_total").remove(),$(".cart_bot").remove())}ajax("GET","../api/cart.php","",function(t){var e=JSON.parse(t).map(function(t){return' <ul>\n                        <h3 class="good_check"><input name="all" type="checkbox"></h3>\n                        <li class="cart_img"><img src="'+t.urlimg+'" alt=""></li>\n                        <li class="cart_title">'+t.title+'</li>\n                        <li class="cart_number">\n                            <span class="jian"></span>\n                            <input type="text" class="text" value="'+t.store+'">\n                            <span class="jia"></span>\n                        </li>\n                        <li class="cart_price">￥'+t.newprice+'</li>\n                        <li class="cart_subtotal subtotal">￥'+t.newprice+'</li>\n                        <li class="cart_ops">\n                            <a href="javascript:;" id="support">删除</a>\n                            | \n                            <a href="javascript:;" id="oppose">收藏</a>\n                        </li>\n                    </ul>'}).join("");n.innerHTML=e}),$("#cart").on("click",".jia",function(){var t=$(this).prev().val();200<=++t&&(t=200);var e=$(this).parent().next().text().substring(1);ajax("GET","../api/update.php","newprice="+e+"&store="+t,function(t){}),$(this).prev().val(t),c($(this));var n=r();i(n),o(n)}),$("#cart").on("click",".jian",function(){var t=$(this).next().val();--t<=1&&(t=1);var e=$(this).parent().next().text().substring(1);ajax("GET","../api/update.php","newprice="+e+"&store="+t,function(t){}),$(this).next().val(t),c($(this));var n=r();i(n),o(n)}),$("#cart").on("click","#support",function(){if(confirm("您确定要删除该商品吗？")){$(this).parent().parent().remove();var t=$(this).parent().prev().prev().text().substring(1);ajax("GET","../api/delete.php","newprice="+t,function(t){})}a();var e=r();i(e),o(e)});var e=!0;function r(){for(var t=[],e=$(".good_check input").size(),n=0;n<e;n++)$(".good_check input").eq(n).prop("checked")&&t.push(n);return t}function i(t){for(var e=0,n=0;n<t.length;n++)e+=parseInt($(".nownum").eq(t[n]).val());$("#allnum").html("已选 "+e+" 件商品")}function o(t){for(var e=0,n=0;n<t.length;n++){var c=$(".subtotal").eq(t[n]).text();e+=1*(c=(c=$.trim(c)).substring(1))}$(".total").html(e.toFixed(2))}$("#allchecked").on("click",function(){e?($(".good_check input").prop("checked","checked"),$("#allchecked input").prop("checked","checked")):($(".good_check input").removeAttr("checked"),$("#allchecked input").removeAttr("checked")),e=!e;var t=r();i(t),o(t)}),$(".clear").on("click",function(){var t=r();if(confirm("您确定要删除多行吗？"))for(var e=t.length-1;0<=e;e--){$(".good_check").eq(t[e]).parent().remove();ajax("GET","../api/delete.php","",function(t){})}a()}),$("#cart").on("click",".good_check",function(){var t;(t=r()).length==$(".good_check").size()?$("#allchecked input").prop("checked","checked"):$("#allchecked input").removeAttr("checked"),i(t=r()),o(t)}),$("#cart").on("blur",".text",function(){c($(this));var t=r();i(t),o(t)})});